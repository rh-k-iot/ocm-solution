<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCM - Oasis Client Manager v2.0</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- 로딩 스크린 -->
    <div id="loading-screen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
            <h2 class="text-xl font-semibold text-gray-800">OCM 시스템 로딩 중...</h2>
            <p class="text-gray-600 mt-2">잠시만 기다려주세요</p>
            <div id="loading-progress" class="mt-4 text-sm text-gray-500"></div>
        </div>
    </div>

    <!-- 메인 애플리케이션 -->
    <div id="root" class="hidden"></div>

    <!-- 에러 표시 영역 -->
    <div id="error-container" class="hidden fixed inset-0 bg-red-50 flex items-center justify-center z-40">
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
            <div class="text-red-600 text-6xl text-center mb-4">⚠️</div>
            <h2 class="text-xl font-bold text-red-800 text-center mb-4">시스템 오류</h2>
            <p id="error-message" class="text-red-600 text-center mb-6"></p>
            <div class="flex justify-center space-x-3">
                <button onclick="location.reload()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                    새로고침
                </button>
                <button onclick="window.OCM_DEBUG?.resetData()" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">
                    데이터 초기화
                </button>
            </div>
        </div>
    </div>

    <!-- ========================================
         Core System Scripts
         ======================================== -->
    
    <!-- 1. Core Configuration -->
    <script type="text/babel">
        // Core configuration and constants (from ocm_core_config)
        const OCM_CONFIG = {
            version: '2.0.0',
            name: 'Oasis Client Manager',
            description: '오아시스 클라이언트 관리 시스템',
            
            api: {
                baseUrl: '',
                timeout: 30000,
                retries: 3
            },
            
            storage: {
                prefix: 'ocm_v2_',
                compression: false,
                encryption: false,
                autoBackup: true
            },
            
            ui: {
                theme: 'default',
                animations: true,
                pageSize: 10
            }
        };

        const OCM_CONSTANTS = {
            STORAGE_KEYS: {
                CLIENTS: 'clients',
                PROJECTS: 'projects',
                QUOTES: 'quotes',
                CONTRACTS: 'contracts',
                TRANSACTIONS: 'transactions',
                SETTLEMENTS: 'settlements'
            },
            
            PROJECT_STATUS: {
                RECEIVED: 'received',
                QUOTED: 'quoted',
                CONTRACTED: 'contracted',
                IN_PROGRESS: 'in_progress',
                COMPLETED: 'completed',
                CANCELLED: 'cancelled'
            },
            
            STATUS_TEXT: {
                received: '접수됨',
                quoted: '견적발송',
                contracted: '계약체결',
                in_progress: '진행중',
                completed: '완료',
                cancelled: '취소됨'
            },
            
            STATUS_COLORS: {
                received: 'bg-blue-100 text-blue-800 border-blue-200',
                quoted: 'bg-yellow-100 text-yellow-800 border-yellow-200',
                contracted: 'bg-green-100 text-green-800 border-green-200',
                in_progress: 'bg-purple-100 text-purple-800 border-purple-200',
                completed: 'bg-gray-100 text-gray-800 border-gray-200',
                cancelled: 'bg-red-100 text-red-800 border-red-200'
            },
            
            PROJECT_TYPES: [
                { value: 'product_design', label: '제품 설계', icon: '🎨' },
                { value: 'prototype', label: '시제품 제작', icon: '🔧' },
                { value: 'consulting', label: '컨설팅', icon: '💡' },
                { value: 'web_development', label: '웹개발', icon: '💻' },
                { value: 'mobile_app', label: '모바일앱', icon: '📱' },
                { value: 'iot_solution', label: 'IoT 솔루션', icon: '🌐' },
                { value: 'other', label: '기타', icon: '📦' }
            ],

            BUDGET_RANGES: [
                { value: 'under_1m', label: '100만원 이하', min: 0, max: 1000000 },
                { value: '1m_5m', label: '100만원 - 500만원', min: 1000000, max: 5000000 },
                { value: '5m_10m', label: '500만원 - 1000만원', min: 5000000, max: 10000000 },
                { value: '10m_50m', label: '1000만원 - 5000만원', min: 10000000, max: 50000000 },
                { value: '50m_100m', label: '5000만원 - 1억원', min: 50000000, max: 100000000 },
                { value: 'over_100m', label: '1억원 이상', min: 100000000, max: Infinity }
            ],

            PRIORITY_LEVELS: {
                LOW: 'low',
                MEDIUM: 'medium',
                HIGH: 'high',
                URGENT: 'urgent'
            },

            PRIORITY_TEXT: {
                low: '낮음',
                medium: '보통',
                high: '높음',
                urgent: '긴급'
            },

            PRIORITY_COLORS: {
                low: 'bg-gray-100 text-gray-800',
                medium: 'bg-blue-100 text-blue-800',
                high: 'bg-yellow-100 text-yellow-800',
                urgent: 'bg-red-100 text-red-800'
            }
        };

        // 전역 객체에 설정
        window.OCM_CONFIG = OCM_CONFIG;
        window.OCM_CONSTANTS = OCM_CONSTANTS;

        console.log('✅ Core Configuration 로드 완료');
    </script>

    <!-- 2. Base Storage System -->
    <script type="text/babel">
        // Base Storage Class (simplified version of ocm_base_storage)
        class BaseStorage {
            constructor(storageKey, options = {}) {
                this.storageKey = storageKey;
                this.options = { autoSave: true, validation: true, ...options };
                this.data = this._loadData();
                this.listeners = new Set();
            }

            getAll() {
                return [...this.data];
            }

            getById(id) {
                return this.data.find(item => item.id === id) || null;
            }

            getWhere(predicate) {
                return this.data.filter(predicate);
            }

            create(itemData) {
                if (this.options.validation) {
                    this.validate(itemData);
                }

                const newItem = {
                    ...itemData,
                    id: itemData.id || this._generateId(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (this.getById(newItem.id)) {
                    throw new Error(`중복된 ID입니다: ${newItem.id}`);
                }

                this.data.push(newItem);
                this._save();
                this._notifyListeners('create', newItem);
                return newItem;
            }

            update(id, updates) {
                const index = this.data.findIndex(item => item.id === id);
                if (index === -1) {
                    throw new Error(`데이터를 찾을 수 없습니다: ${id}`);
                }

                const updatedItem = {
                    ...this.data[index],
                    ...updates,
                    id,
                    updatedAt: new Date().toISOString()
                };

                if (this.options.validation) {
                    this.validate(updatedItem);
                }

                this.data[index] = updatedItem;
                this._save();
                this._notifyListeners('update', updatedItem);
                return updatedItem;
            }

            delete(id) {
                const index = this.data.findIndex(item => item.id === id);
                if (index === -1) return false;

                const deletedItem = this.data[index];
                this.data.splice(index, 1);
                this._save();
                this._notifyListeners('delete', deletedItem);
                return true;
            }

            exists(id) {
                return this.data.some(item => item.id === id);
            }

            count() {
                return this.data.length;
            }

            clear() {
                this.data = [];
                this._save();
                this._notifyListeners('clear', []);
            }

            subscribe(listener) {
                this.listeners.add(listener);
                return () => this.listeners.delete(listener);
            }

            validate(data) {
                // 서브클래스에서 구현
            }

            _loadData() {
                try {
                    const key = `${OCM_CONFIG.storage.prefix}${this.storageKey}`;
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error(`[${this.storageKey}] 데이터 로드 오류:`, error);
                    return [];
                }
            }

            _save() {
                try {
                    const key = `${OCM_CONFIG.storage.prefix}${this.storageKey}`;
                    localStorage.setItem(key, JSON.stringify(this.data));
                } catch (error) {
                    console.error(`[${this.storageKey}] 데이터 저장 오류:`, error);
                    throw error;
                }
            }

            _generateId() {
                return `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }

            _notifyListeners(action, data) {
                this.listeners.forEach(listener => {
                    try {
                        listener(action, data, this.storageKey);
                    } catch (error) {
                        console.error('리스너 실행 오류:', error);
                    }
                });
            }
        }

        // Storage Manager
        class StorageManager {
            constructor() {
                this.storages = new Map();
            }

            register(name, storage) {
                this.storages.set(name, storage);
            }

            get(name) {
                return this.storages.get(name) || null;
            }
        }

        // 전역 스토리지 매니저 생성
        window.OCM_STORAGE_MANAGER = new StorageManager();
        window.OCM_BASE_STORAGE = { BaseStorage, StorageManager };

        console.log('✅ Base Storage System 로드 완료');
    </script>

    <!-- 3. Client Management Module -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Client Storage
        class ClientStorage extends BaseStorage {
            constructor() {
                super('clients');
            }

            validate(data) {
                const required = ['companyName', 'contactPerson', 'email', 'phone'];
                const missing = required.filter(field => !data[field]);
                
                if (missing.length > 0) {
                    throw new Error(`필수 필드가 누락되었습니다: ${missing.join(', ')}`);
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(data.email)) {
                    throw new Error('올바른 이메일 형식이 아닙니다.');
                }
            }

            getByEmail(email) {
                return this.getWhere(client => 
                    client.email.toLowerCase() === email.toLowerCase()
                )[0] || null;
            }
        }

        // Client Service
        class ClientService {
            constructor(storage) {
                this.storage = storage;
            }

            async createClient(clientData) {
                const existingClient = this.storage.getByEmail(clientData.email);
                if (existingClient) {
                    throw new Error('이미 등록된 이메일입니다.');
                }

                const newClient = {
                    ...clientData,
                    clientType: clientData.clientType || 'corporate',
                    status: 'active'
                };

                return this.storage.create(newClient);
            }

            async updateClient(id, updates) {
                return this.storage.update(id, updates);
            }

            async deleteClient(id) {
                return this.storage.delete(id);
            }

            searchClients(searchParams) {
                const { query, clientType, status } = searchParams;
                let results = this.storage.getAll();

                if (query) {
                    const lowerQuery = query.toLowerCase();
                    results = results.filter(client => 
                        client.companyName.toLowerCase().includes(lowerQuery) ||
                        client.contactPerson.toLowerCase().includes(lowerQuery) ||
                        client.email.toLowerCase().includes(lowerQuery)
                    );
                }

                if (clientType) {
                    results = results.filter(client => client.clientType === clientType);
                }

                if (status) {
                    results = results.filter(client => client.status === status);
                }

                return results;
            }
        }

        // Client Management Component
        const ClientManagement = () => {
            const [clients, setClients] = useState([]);
            const [currentView, setCurrentView] = useState('list');
            const [selectedClient, setSelectedClient] = useState(null);
            const [loading, setLoading] = useState(true);

            const clientService = useMemo(() => {
                const storage = new ClientStorage();
                window.OCM_STORAGE_MANAGER.register('clients', storage);
                return new ClientService(storage);
            }, []);

            useEffect(() => {
                loadClients();
            }, []);

            const loadClients = async () => {
                try {
                    setLoading(true);
                    const allClients = clientService.storage.getAll();
                    setClients(allClients);
                } catch (error) {
                    console.error('클라이언트 로드 오류:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleCreateClient = () => {
                setSelectedClient(null);
                setCurrentView('form');
            };

            const handleSaveClient = async (clientData) => {
                try {
                    if (selectedClient) {
                        await clientService.updateClient(selectedClient.id, clientData);
                    } else {
                        await clientService.createClient(clientData);
                    }
                    await loadClients();
                    setCurrentView('list');
                } catch (error) {
                    throw error;
                }
            };

            if (loading) {
                return (
                    <div className="flex justify-center items-center h-64">
                        <div className="loading-spinner rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                        <span className="ml-3 text-gray-600">클라이언트 정보를 불러오는 중...</span>
                    </div>
                );
            }

            if (currentView === 'form') {
                return React.createElement(ClientForm, {
                    client: selectedClient,
                    onSave: handleSaveClient,
                    onCancel: () => setCurrentView('list')
                });
            }

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h1 className="text-2xl font-bold text-gray-900">클라이언트 관리</h1>
                            <p className="text-gray-600 mt-1">총 {clients.length}개의 클라이언트</p>
                        </div>
                        <button
                            onClick={handleCreateClient}
                            className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center space-x-2"
                        >
                            <span>➕</span>
                            <span>새 클라이언트</span>
                        </button>
                    </div>

                    <div className="bg-white shadow rounded-lg overflow-hidden">
                        {clients.length === 0 ? (
                            <div className="text-center py-12">
                                <div className="text-gray-400 text-6xl mb-4">👥</div>
                                <h3 className="text-lg font-medium text-gray-900 mb-2">등록된 클라이언트가 없습니다</h3>
                                <p className="text-gray-500">첫 번째 클라이언트를 등록해보세요.</p>
                            </div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">회사명</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">담당자</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">이메일</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">전화번호</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">등록일</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">작업</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {clients.map(client => (
                                            <tr key={client.id} className="hover:bg-gray-50">
                                                <td className="px-6 py-4 whitespace-nowrap font-medium text-gray-900">
                                                    {client.companyName}
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-gray-900">
                                                    {client.contactPerson}
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-gray-600">
                                                    {client.email}
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-gray-600">
                                                    {client.phone}
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-gray-600">
                                                    {new Date(client.createdAt).toLocaleDateString('ko-KR')}
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-right">
                                                    <button
                                                        onClick={() => {
                                                            setSelectedClient(client);
                                                            setCurrentView('form');
                                                        }}
                                                        className="text-blue-600 hover:text-blue-900 mr-3"
                                                    >
                                                        수정
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            if (confirm('정말로 삭제하시겠습니까?')) {
                                                                clientService.deleteClient(client.id);
                                                                loadClients();
                                                            }
                                                        }}
                                                        className="text-red-600 hover:text-red-900"
                                                    >
                                                        삭제
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Client Form Component
        const ClientForm = ({ client, onSave, onCancel }) => {
            const [formData, setFormData] = useState({
                companyName: '',
                contactPerson: '',
                email: '',
                phone: '',
                website: '',
                address: '',
                clientType: 'corporate',
                notes: '',
                ...client
            });

            const [errors, setErrors] = useState({});
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
                if (errors[field]) {
                    setErrors(prev => ({ ...prev, [field]: null }));
                }
            };

            const validateForm = () => {
                const newErrors = {};

                if (!formData.companyName.trim()) {
                    newErrors.companyName = '회사명을 입력해주세요.';
                }
                if (!formData.contactPerson.trim()) {
                    newErrors.contactPerson = '담당자명을 입력해주세요.';
                }
                if (!formData.email.trim()) {
                    newErrors.email = '이메일을 입력해주세요.';
                } else {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(formData.email)) {
                        newErrors.email = '올바른 이메일 형식이 아닙니다.';
                    }
                }
                if (!formData.phone.trim()) {
                    newErrors.phone = '전화번호를 입력해주세요.';
                }

                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!validateForm()) return;

                setIsSubmitting(true);
                try {
                    await onSave(formData);
                } catch (error) {
                    setErrors({ submit: error.message });
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow">
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">
                        {client ? '클라이언트 수정' : '새 클라이언트 등록'}
                    </h2>

                    <form onSubmit={handleSubmit} className="space-y-6">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">클라이언트 유형</label>
                            <div className="flex space-x-4">
                                <label className="flex items-center">
                                    <input
                                        type="radio"
                                        name="clientType"
                                        value="corporate"
                                        checked={formData.clientType === 'corporate'}
                                        onChange={(e) => handleChange('clientType', e.target.value)}
                                        className="mr-2"
                                    />
                                    기업
                                </label>
                                <label className="flex items-center">
                                    <input
                                        type="radio"
                                        name="clientType"
                                        value="individual"
                                        checked={formData.clientType === 'individual'}
                                        onChange={(e) => handleChange('clientType', e.target.value)}
                                        className="mr-2"
                                    />
                                    개인
                                </label>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">회사명 *</label>
                                <input
                                    type="text"
                                    value={formData.companyName}
                                    onChange={(e) => handleChange('companyName', e.target.value)}
                                    className={`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 ${
                                        errors.companyName ? 'border-red-500' : 'border-gray-300'
                                    }`}
                                    placeholder="회사명을 입력하세요"
                                />
                                {errors.companyName && <p className="text-red-500 text-sm mt-1">{errors.companyName}</p>}
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">담당자명 *</label>
                                <input
                                    type="text"
                                    value={formData.contactPerson}
                                    onChange={(e) => handleChange('contactPerson', e.target.value)}
                                    className={`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 ${
                                        errors.contactPerson ? 'border-red-500' : 'border-gray-300'
                                    }`}
                                    placeholder="담당자명을 입력하세요"
                                />
                                {errors.contactPerson && <p className="text-red-500 text-sm mt-1">{errors.contactPerson}</p>}
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">이메일 *</label>
                                <input
                                    type="email"
                                    value={formData.email}
                                    onChange={(e) => handleChange('email', e.target.value)}
                                    className={`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 ${
                                        errors.email ? 'border-red-500' : 'border-gray-300'
                                    }`}
                                    placeholder="example@company.com"
                                />
                                {errors.email && <p className="text-red-500 text-sm mt-1">{errors.email}</p>}
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">전화번호 *</label>
                                <input
                                    type="tel"
                                    value={formData.phone}
                                    onChange={(e) => handleChange('phone', e.target.value)}
                                    className={`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 ${
                                        errors.phone ? 'border-red-500' : 'border-gray-300'
                                    }`}
                                    placeholder="02-1234-5678"
                                />
                                {errors.phone && <p className="text-red-500 text-sm mt-1">{errors.phone}</p>}
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">웹사이트</label>
                            <input
                                type="url"
                                value={formData.website}
                                onChange={(e) => handleChange('website', e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                placeholder="https://www.company.com"
                            />
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">주소</label>
                            <textarea
                                value={formData.address}
                                onChange={(e) => handleChange('address', e.target.value)}
                                rows={2}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                placeholder="주소를 입력하세요"
                            />
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">메모</label>
                            <textarea
                                value={formData.notes}
                                onChange={(e) => handleChange('notes', e.target.value)}
                                rows={3}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                placeholder="추가 정보나 특이사항을 입력하세요"
                            />
                        </div>

                        {errors.submit && (
                            <div className="bg-red-50 border border-red-200 rounded-md p-4">
                                <p className="text-red-800">{errors.submit}</p>
                            </div>
                        )}

                        <div className="flex justify-end space-x-3">
                            <button
                                type="button"
                                onClick={onCancel}
                                className="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
                                disabled={isSubmitting}
                            >
                                취소
                            </button>
                            <button
                                type="submit"
                                disabled={isSubmitting}
                                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"
                            >
                                {isSubmitting ? '저장 중...' : (client ? '수정' : '등록')}
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // 컴포넌트 등록
        window.OCM_COMPONENTS = window.OCM_COMPONENTS || {};
        window.OCM_COMPONENTS.ClientManagement = ClientManagement;
        window.OCM_CLIENT_SERVICE = new ClientService(new ClientStorage());

        console.log('✅ Client Management Module 로드 완료');
    </script>

    <!-- 4. Dashboard Component -->
    <script type="text/babel">
        const Dashboard = () => {
            const [stats, setStats] = useState({
                totalClients: 0,
                totalProjects: 0,
                activeProjects: 0,
                completedProjects: 0,
                totalRevenue: 0,
                pendingQuotes: 0
            });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadStats();
            }, []);

            const loadStats = async () => {
                try {
                    setLoading(true);
                    
                    const clientStorage = window.OCM_STORAGE_MANAGER?.get('clients');
                    const projectStorage = window.OCM_STORAGE_MANAGER?.get('projects');
                    
                    const clients = clientStorage ? clientStorage.getAll() : [];
                    const projects = projectStorage ? projectStorage.getAll() : [];
                    
                    const activeProjects = projects.filter(p => 
                        ['received', 'quoted', 'contracted', 'in_progress'].includes(p.status)
                    );
                    const completedProjects = projects.filter(p => p.status === 'completed');

                    setStats({
                        totalClients: clients.length,
                        totalProjects: projects.length,
                        activeProjects: activeProjects.length,
                        completedProjects: completedProjects.length,
                        totalRevenue: 0, // TODO: 계약 데이터에서 계산
                        pendingQuotes: projects.filter(p => p.status === 'received').length
                    });
                } catch (error) {
                    console.error('통계 로드 오류:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="flex justify-center items-center h-64">
                        <div className="loading-spinner rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                        <span className="ml-3 text-gray-600">대시보드 로딩 중...</span>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    <div>
                        <h1 className="text-2xl font-bold text-gray-900">대시보드</h1>
                        <p className="text-gray-600 mt-1">OCM 시스템 현황을 한눈에 확인하세요</p>
                    </div>

                    {/* 통계 카드 */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="bg-white p-6 rounded-lg shadow">
                            <div className="flex items-center">
                                <div className="flex-shrink-0">
                                    <div className="w-8 h-8 bg-blue-100 rounded-md flex items-center justify-center">
                                        <span className="text-blue-600 text-lg">👥</span>
                                    </div>
                                </div>
                                <div className="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt className="text-sm font-medium text-gray-500 truncate">총 클라이언트</dt>
                                        <dd className="text-lg font-medium text-gray-900">{stats.totalClients}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-lg shadow">
                            <div className="flex items-center">
                                <div className="flex-shrink-0">
                                    <div className="w-8 h-8 bg-green-100 rounded-md flex items-center justify-center">
                                        <span className="text-green-600 text-lg">📋</span>
                                    </div>
                                </div>
                                <div className="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt className="text-sm font-medium text-gray-500 truncate">진행 중인 프로젝트</dt>
                                        <dd className="text-lg font-medium text-gray-900">{stats.activeProjects}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-lg shadow">
                            <div className="flex items-center">
                                <div className="flex-shrink-0">
                                    <div className="w-8 h-8 bg-purple-100 rounded-md flex items-center justify-center">
                                        <span className="text-purple-600 text-lg">✅</span>
                                    </div>
                                </div>
                                <div className="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt className="text-sm font-medium text-gray-500 truncate">완료된 프로젝트</dt>
                                        <dd className="text-lg font-medium text-gray-900">{stats.completedProjects}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-lg shadow">
                            <div className="flex items-center">
                                <div className="flex-shrink-0">
                                    <div className="w-8 h-8 bg-yellow-100 rounded-md flex items-center justify-center">
                                        <span className="text-yellow-600 text-lg">💰</span>
                                    </div>
                                </div>
                                <div className="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt className="text-sm font-medium text-gray-500 truncate">대기 중인 견적</dt>
                                        <dd className="text-lg font-medium text-gray-900">{stats.pendingQuotes}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 빠른 액션 */}
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h3 className="text-lg font-medium text-gray-900 mb-4">빠른 액션</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button
                                onClick={() => window.OCM_APP?.setActiveTab('clients')}
                                className="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg text-left transition-colors"
                            >
                                <div className="font-medium text-blue-700">새 클라이언트 등록</div>
                                <div className="text-sm text-blue-600">새로운 프로젝트 의뢰를 등록하세요</div>
                            </button>
                            
                            <button
                                onClick={() => window.OCM_APP?.setActiveTab('projects')}
                                className="p-4 bg-green-50 hover:bg-green-100 rounded-lg text-left transition-colors"
                            >
                                <div className="font-medium text-green-700">프로젝트 관리</div>
                                <div className="text-sm text-green-600">진행 중인 프로젝트를 확인하세요</div>
                            </button>
                            
                            <button
                                onClick={() => alert('견적서 기능은 준비 중입니다.')}
                                className="p-4 bg-purple-50 hover:bg-purple-100 rounded-lg text-left transition-colors"
                            >
                                <div className="font-medium text-purple-700">견적서 작성</div>
                                <div className="text-sm text-purple-600">새로운 견적서를 작성하세요</div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        window.OCM_COMPONENTS.Dashboard = Dashboard;
        console.log('✅ Dashboard Component 로드 완료');
    </script>

    <!-- 5. Main Layout and Navigation -->
    <script type="text/babel">
        const MainLayout = ({ children, activeTab, onTabChange }) => {
            const tabs = [
                { id: 'dashboard', label: '대시보드', icon: '🏠' },
                { id: 'clients', label: '클라이언트', icon: '👥' },
                { id: 'projects', label: '프로젝트', icon: '📋' },
                { id: 'quotes', label: '견적서', icon: '💰' },
                { id: 'contracts', label: '계약서', icon: '📄' },
                { id: 'transactions', label: '거래명세서', icon: '📊' }
            ];

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* 헤더 */}
                    <header className="bg-white shadow">
                        <div className="px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <div className="flex items-center">
                                    <h1 className="text-2xl font-bold text-gray-900">
                                        OCM <span className="text-sm font-normal text-gray-500">v2.0</span>
                                    </h1>
                                </div>
                                <div className="text-sm text-gray-500">
                                    Oasis Client Manager
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="flex">
                        {/* 사이드바 */}
                        <div className="w-64 bg-white shadow-sm">
                            <nav className="mt-5 px-2">
                                <div className="space-y-1">
                                    {tabs.map(tab => (
                                        <button
                                            key={tab.id}
                                            onClick={() => onTabChange(tab.id)}
                                            className={`group flex items-center w-full px-2 py-2 text-sm font-medium rounded-md transition-colors ${
                                                activeTab === tab.id
                                                    ? 'bg-blue-100 text-blue-700'
                                                    : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'
                                            }`}
                                        >
                                            <span className="mr-3 text-lg">{tab.icon}</span>
                                            {tab.label}
                                        </button>
                                    ))}
                                </div>
                            </nav>
                        </div>

                        {/* 메인 컨텐츠 */}
                        <div className="flex-1">
                            <main className="py-6 px-4 sm:px-6 lg:px-8">
                                <div className="fade-in">
                                    {children}
                                </div>
                            </main>
                        </div>
                    </div>
                </div>
            );
        };

        window.OCM_COMPONENTS.MainLayout = MainLayout;
        console.log('✅ Main Layout Component 로드 완료');
    </script>

    <!-- 6. Main Application -->
    <script type="text/babel">
        const MainApp = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isInitialized, setIsInitialized] = useState(false);

            useEffect(() => {
                initializeApp();
            }, []);

            const initializeApp = async () => {
                try {
                    // 시스템 초기화
                    updateProgress('시스템 구성 요소 확인 중...');
                    await new Promise(resolve => setTimeout(resolve, 500));

                    updateProgress('데이터 스토리지 초기화 중...');
                    await new Promise(resolve => setTimeout(resolve, 500));

                    updateProgress('컴포넌트 로딩 중...');
                    await new Promise(resolve => setTimeout(resolve, 500));

                    updateProgress('초기화 완료!');
                    await new Promise(resolve => setTimeout(resolve, 500));

                    setIsInitialized(true);
                    hideLoadingScreen();
                } catch (error) {
                    console.error('앱 초기화 오류:', error);
                    showError('시스템 초기화에 실패했습니다: ' + error.message);
                }
            };

            const renderContent = () => {
                switch (activeTab) {
                    case 'dashboard':
                        return React.createElement(window.OCM_COMPONENTS.Dashboard);
                    case 'clients':
                        return React.createElement(window.OCM_COMPONENTS.ClientManagement);
                    case 'projects':
                        return <div className="text-center py-12 text-gray-500">프로젝트 관리 기능 준비 중...</div>;
                    case 'quotes':
                        return <div className="text-center py-12 text-gray-500">견적서 관리 기능 준비 중...</div>;
                    case 'contracts':
                        return <div className="text-center py-12 text-gray-500">계약서 관리 기능 준비 중...</div>;
                    case 'transactions':
                        return <div className="text-center py-12 text-gray-500">거래명세서 관리 기능 준비 중...</div>;
                    default:
                        return <div className="text-center py-12 text-gray-500">페이지를 찾을 수 없습니다.</div>;
                }
            };

            if (!isInitialized) {
                return null;
            }

            return React.createElement(
                window.OCM_COMPONENTS.MainLayout,
                {
                    activeTab,
                    onTabChange: setActiveTab
                },
                renderContent()
            );
        };

        // 전역 앱 객체
        window.OCM_APP = {
            setActiveTab: (tab) => {
                // React 상태 업데이트는 컴포넌트 내부에서만 가능
                console.log('탭 변경 요청:', tab);
            }
        };

        console.log('✅ Main Application 로드 완료');
    </script>

    <!-- 7. Utility Functions -->
    <script>
        // 로딩 스크린 제어
        function updateProgress(message) {
            const progressEl = document.getElementById('loading-progress');
            if (progressEl) {
                progressEl.textContent = message;
            }
            console.log('⏳', message);
        }

        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            const rootEl = document.getElementById('root');
            
            if (loadingScreen && rootEl) {
                loadingScreen.style.display = 'none';
                rootEl.classList.remove('hidden');
            }
        }

        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            const errorMessage = document.getElementById('error-message');
            const loadingScreen = document.getElementById('loading-screen');
            
            if (errorContainer && errorMessage) {
                errorMessage.textContent = message;
                errorContainer.classList.remove('hidden');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
            }
        }

        // 디버그 도구
        window.OCM_DEBUG = {
            checkStatus: () => {
                console.log('=== OCM v2.0 시스템 상태 ===');
                console.log('Config:', !!window.OCM_CONFIG);
                console.log('Constants:', !!window.OCM_CONSTANTS);
                console.log('Storage Manager:', !!window.OCM_STORAGE_MANAGER);
                console.log('Components:', Object.keys(window.OCM_COMPONENTS || {}));
                console.log('Clients:', window.OCM_STORAGE_MANAGER?.get('clients')?.count() || 0);
            },
            
            resetData: () => {
                if (confirm('모든 데이터를 초기화하시겠습니까?')) {
                    localStorage.clear();
                    location.reload();
                }
            },

            addSampleData: () => {
                const clientStorage = window.OCM_STORAGE_MANAGER?.get('clients');
                if (!clientStorage) return;

                try {
                    clientStorage.create({
                        companyName: '샘플 회사',
                        contactPerson: '홍길동',
                        email: 'sample@example.com',
                        phone: '02-1234-5678',
                        clientType: 'corporate'
                    });
                    console.log('✅ 샘플 데이터 추가 완료');
                    location.reload();
                } catch (error) {
                    console.error('샘플 데이터 추가 실패:', error);
                }
            }
        };

        // 전역 에러 처리
        window.addEventListener('error', (event) => {
            console.error('전역 오류:', event.error);
            showError('시스템 오류가 발생했습니다: ' + event.error.message);
        });

        console.log('✅ 유틸리티 함수 로드 완료');
    </script>

    <!-- 8. Application Bootstrap -->
    <script type="text/babel">
        // 앱 시작
        function startApp() {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(MainApp));
        }

        // DOM 로드 완료 후 앱 시작
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 OCM v2.0 시스템 시작');
            startApp();
        });
    </script>
</body>
</html>
